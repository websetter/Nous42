
{% macro get_nav_bar(categories, currentScopeUrl) %}
    {% import _self as navbar %}
    {% set counter = 0 %}
    {% set megaMenuLevels = not config('Ceres.header.megamenu_levels') ? 1 : config('Ceres.header.megamenu_levels') %}

    {% for category in categories %}

        {% if category.details | length > 0 %}

            {% if urls.includeLanguage %}
                {% set currentScopeUrl = "/" ~ category.details[0].lang ~  "/" ~ category.details[0].nameUrl %}
            {% else %}
                {% set currentScopeUrl = "/" ~ category.details[0].nameUrl %}
            {% endif %}
            {% set translatedChildren = 0 %}
            {% for children in category.children if children.details[0] %}
                {% set translatedChildren = translatedChildren + 1 %}
            {% endfor %}

            {% if category.children and translatedChildren > 0 %}

            <li class="ddown {% for breadcrumb in breadcrumbs %}{% if category.id == breadcrumb.id %} active{% endif %}{% endfor %}">
               <a href="{{ currentScopeUrl }}{{ urls.trailingSlashSuffix }}">{{ category.details[0].name }}</a>

               <span class="d-lg-none nav-direction" data-toggle="collapse" href="#navDropdown{{ counter }}" aria-expanded="false">
                   <i class="fa fa-caret-down" aria-hidden="true"></i>
               </span>

                    <ul data-level="1" id="navDropdown{{ counter }}" class="collapse">
                        {% set counter = counter + 1 %}
                        {% if megaMenuLevels == "1" %}
                            {% for child in category.children %}
                                {% if child.details | length > 0 %}
                                    <li>
                                      <a href="{{ currentScopeUrl }}/{{ child.details[0].nameUrl }}{{ urls.trailingSlashSuffix }}">{{ child.details[0].name }}</a>
                                    </li>
                                {% endif %}
                            {% endfor %}
                        {% else %}
                            {{ navbar.get_children(category, currentScopeUrl, 1) }}
                        {% endif %}
                    </ul>
                </li>

            {% else %}

                <li class="{% for breadcrumb in breadcrumbs %}{% if category.id == breadcrumb.id %} active{% endif %}{% endfor %}">
                  <a href="{{ currentScopeUrl }}{{ urls.trailingSlashSuffix }}">{{ category.details[0].name }}</a>
                </li>

            {% endif %}
        {% endif %}
    {% endfor %}

{% endmacro %}

{% macro get_menu(breadcrumbs, categories, currentScopeUrl, counter) %}
    {% import _self as sidemenu %}
    {% set urlNow = currentScopeUrl %}
      {% for category in categories %}
          {% set urlNow = currentScopeUrl ~ "/" ~ category.details[0].nameUrl %}
          {% if category.details[0] %}
              <li id="plentycat_{{ category.id }}" class="{% if category.children is not empty %}ddown {% endif %}{% for breadcrumb in breadcrumbs %}{% if category.id == breadcrumb.id %} active{% endif %}{% endfor %}">
                  <a href="{{ urlNow }}{{ urls.trailingSlashSuffix }}" title="{{ category.details[0].name }}">{{ category.details[0].name }}</a>
                  {% if category.children is not empty  %}
                  <span class="d-lg-none nav-direction" data-toggle="collapse" href="#navDropdown{{ counter }}" aria-expanded="false">
                      <i class="fa fa-caret-down" aria-hidden="true"></i>
                  </span>
                      <ul d="navDropdown{{ counter }}" class="collapse">
                          {{ sidemenu.get_menu(breadcrumbs, category.children, urlNow, counter + 1) }}
                      </ul>
                  {% endif %}
              </li>
          {% endif %}
      {% endfor %}
{% endmacro %}
