{% extends getPartial('page-design') %}
{% import "Ceres::Category.Macros.CategoryTree" as Tree %}
{% import "Ceres::PageDesign.Macros.LayoutContainer" as LayoutContainer %}

{% block PageBody %}

    {{ component( "Ceres::ItemList.Components.Filter.ItemFilterList") }}
    {{ component( "Ceres::ItemList.Components.Filter.ItemFilterTagList") }}
    {{ component( "Nous42::ItemList.Components.CategoryItem" ) }}

    {% set shippingCat = config("Ceres.global.shippingCostsCategoryId") %}

    <div class="categoriegrid page-content container categoryItem">

        {% if isSearch %}
          <div class="row mt-3">
              <div class="col-12">
                  <h1>
                      {% if isTag %}
                          {{ trans("Ceres::Template.tagSearchResults", {"searchString": searchString}) }}
                      {% else %}
                          {{ trans("Ceres::Template.itemSearchResults") }} {{ searchString }}
                      {% endif %}
                  </h1>
              </div>
          </div>
      {% endif %}

      {% if category is defined and not ceresConfig.item.showCategoryImage %}
        <div id="category-description-container" class="category-description">{{ category.details[0].description | raw }}</div>
      {% endif %}

        <div class="list-controls">
            <div class="list-controls-inner">
                <div class="row">
                    <div class="col-xs-12">
                        <div class="list-wrapper">
                          {% include "Ceres::Category.Item.Partials.ItemSorting" with { 'sortingData': searchOptions.sorting, 'selectedSorting': itemSorting } %}
                          {% include "Ceres::Category.Item.Partials.ItemsPerPage" with { 'itemsPerPage': searchOptions.itemsPerPage, 'selectedValue': itemsPerPage } %}

                        </div>
                    </div>
                </div>
            </div>
        </div>

        {% if ceresConfig.pagination.position in ['top', 'top_bottom'] %}
               <div class="list-controls mb-5 row">
                   <div class="col-12">
                       <div class="float-right row">
                           {% include "Ceres::Category.Item.Partials.Pagination" %}
                       </div>
                   </div>
               </div>
           {% endif %}

        <div class="row">
            <div class="col-12">

              {% if itemList is not empty %}
                  <ul class="product-list row grid">
                      {% for item in itemList %}
                          <li class="col-xs-12 col-sm-6 col-md-4 col-lg-3">
                              <category-item
                                  item-data-ref="{{ item.data | json_data }}"
                                  :decimal-count="{{ ceresConfig.item.storeSpecial }}">
                                  <template #before-prices>{{ LayoutContainer.show("Ceres::CategoryItem.BeforePrices", item.data) }}</template>
                                  <template #after-prices>{{ LayoutContainer.show("Ceres::CategoryItem.AfterPrices", item.data) }}</template>

                                  <a href="{{ item.data | itemURL }}" class="small">
                                      <i class="fa fa-image"></i>
                                      <span>{{ item.data | itemName }}</span>
                                  </a>
                              </category-item>
                          </li>
                      {% endfor %}
                  </ul>
              {% endif %}
            </div>
        </div>

          {% if ceresConfig.pagination.position in ['bottom', 'top_bottom'] %}
              <div class="list-controls mb-5 row">
                  <div class="col-12">
                      <div class="float-right row">
                          {% include "Ceres::Category.Item.Partials.Pagination" %}
                      </div>
                  </div>
              </div>
          {% endif %}
    </div>

    {% if category.details[0].description2 | trim is not empty %}
        <div id="category-description-container-2" class="category-description">{{ category.details[0].description2 | raw }}</div>
    {% endif %}

{% endblock %}

{% block PartialHead %}
    <script type="application/ld+json">{"@context": "https://schema.org","@type": "WebSite","url": "{{ webstoreConfig.domainSsl }}","potentialAction":{"@type": "SearchAction","target": "{{ domainSsl }}/search?query={search_term}","query-input": "required name=search_term"}}</script>

    {% if currentPage - 1 > 0 %}
        <link rel="prev" href="{{ canonicalUrl ~ queryString({'page': currentPage - 1}) }}" />
    {% endif %}

    {% if currentPage + 1 <= pageMax %}
        <link rel="next" href="{{ canonicalUrl ~ queryString({'page': currentPage + 1}) }}" />
    {% endif %}

    <title>{% if category.details[0].metaTitle %}{{ category.details[0].metaTitle }}{% else %}{{ category.details[0].name }}{% endif %}</title>

    <meta name="description" content="{{ category.details[0].metaDescription }}">
    <meta name="keywords" content="{{ category.details[0].metaKeywords }}">

    <meta name="robots" content="{{ metaRobots }}">
{% endblock %}
